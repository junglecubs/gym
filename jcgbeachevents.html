<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jungle Cubs Beach Events ‚Äî Registration</title>
  <style>
    /* --- JUNGLE CUBS BRAND COLORS --- */
    :root {
      --jc-yellow: #f9ca2b;
      --jc-green: #287844;
      --jc-red: #c72e31;
      --jc-brown: #763230;
      --bg-color: #f4f8f5;
    }

    /* --- RESET & BASIC --- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg-color);
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      color: #333;
    }

    /* --- CARD DESIGN --- */
    .box {
      background: #fff;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px -5px rgba(40, 120, 68, 0.15);
      max-width: 800px;
      width: 100%;
      border-top: 6px solid var(--jc-yellow);
    }

    /* --- TYPOGRAPHY --- */
    h1 {
      color: var(--jc-green);
      font-size: 1.8rem;
      margin-bottom: 1rem;
      font-weight: 800;
      text-align: center;
      letter-spacing: -0.5px;
    }

    label {
      font-weight: 700;
      color: var(--jc-brown);
      display: block;
      margin-top: 1rem;
      font-size: 0.95rem;
    }

    .small-note {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
      display: block;
      font-weight: 400;
    }

    /* --- INPUTS --- */
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    input,
    select {
      width: 100%;
      padding: 0.85rem;
      border: 1px solid #dcdfe3;
      border-radius: 8px;
      margin-top: 6px;
      font-size: 1rem;
      background: #fff;
      transition: all 0.2s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--jc-green);
      box-shadow: 0 0 0 3px rgba(40, 120, 68, 0.1);
    }

    input[readonly] {
      background: #f7f7f7;
      color: #888;
      cursor: not-allowed;
      border-color: #eee;
    }

    /* --- BUTTONS --- */
    .button-style {
      display: block;
      width: 100%;
      text-align: center;
      padding: 1rem;
      margin: 24px 0 0;
      font-weight: 800;
      font-size: 1.1rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.1s ease, background-color 0.2s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .button-style:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    /* PRIMARY: Green BG + Yellow Text */
    .primary {
      background: var(--jc-green);
      color: var(--jc-yellow);
    }

    .primary:hover:not([disabled]) {
      background: #1e6336;
      color: #fff;
    }

    .primary[disabled] {
      background: #a8c4b1;
      color: #f1f1f1;
      cursor: not-allowed;
      box-shadow: none;
      opacity: 0.8;
    }

    /* SECONDARY: Brown BG */
    .secondary {
      background: var(--jc-brown);
      color: #fff;
      font-size: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
    }

    .secondary:hover {
      background: #5d2624;
    }

    /* --- PAYMENT SECTION --- */
    .summary {
      margin-top: 20px;
      background: #fffdf0;
      border: 1px solid #f0e6c5;
      border-radius: 12px;
      padding: 16px;
      font-size: .95rem;
      color: #333;
    }

    .pay-wrap {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 16px;
      align-items: stretch;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 16px;
    }

    .qr-box {
      background: #fff;
      border: 2px dashed #ddd;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .qr-box img {
      display: block;
    }

    .pay-col {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .hint {
      font-size: 0.85rem;
      color: #555;
      margin-top: 8px;
      font-weight: 500;
    }

    .muted.rich {
      margin-top: 8px;
      line-height: 1.5;
      color: #444;
    }

    /* --- CONFIRMATION CHECKBOX --- */
    .payment-confirm {
      margin-top: 16px;
      padding: 12px;
      background: #eaf3ed;
      border-radius: 8px;
      border: 1px solid #cce0d3;
    }

    .payment-confirm-label {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      font-size: 14px;
      line-height: 1.4;
      color: var(--jc-green);
      font-weight: 600;
      cursor: pointer;
      margin-top: 0;
    }

    .payment-confirm-label input {
      margin-top: 3px;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      accent-color: var(--jc-green);
    }

    .payment-confirm-label span {
      flex: 1;
      display: block;
      min-width: 0;
    }

    /* --- UTILITIES --- */
    .hidden {
      display: none;
    }

    @media (max-width: 780px) {

      .row,
      .pay-wrap {
        grid-template-columns: 1fr;
      }

      .box {
        padding: 1.25rem;
      }
    }
  </style>
</head>

<body>

  <div class="box">
    <div style="text-align:center; margin-bottom: 20px;">
      <img src="https://junglecubsgyms.com/imgw/logo_light.png" alt="Jungle Cubs Gym Logo"
        style="height:90px; width:auto; object-fit:contain;">
    </div>

    <h1>Jungle Cubs Beach Events ‚Äî Registration üèñÔ∏è</h1>

    <div
      style="margin: 0 auto 24px; max-width: 640px; border: 4px solid var(--jc-yellow); border-radius: 14px; overflow: hidden;">
      <div style="position: relative; width: 100%; padding-bottom: 56.25%;">
        <iframe
          src="https://www.youtube.com/embed/en-luNR_Hrs?autoplay=1&mute=1&controls=0&loop=1&playlist=en-luNR_Hrs&playsinline=1&modestbranding=1&rel=0&showinfo=0"
          frameborder="0" allow="autoplay; encrypted-media" allowfullscreen
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
      </div>
    </div>
    <p
      style="font-size: 0.95rem; color: #555; margin-top: -16px; margin-bottom: 20px; text-align: center; font-style: italic;">
      A glimpse of our Jungle Cubs Beach Events üåä
    </p>

    <form id="beachForm" method="post" action="">

      <div class="row">
        <div><label>Parent Name<input type="text" name="parentName" id="parentName" required /></label></div>
        <div><label>Child Name<input type="text" name="childName" id="childName" required /></label></div>
      </div>

      <div class="row">
        <div><label>Child DOB<input type="date" name="childDOB" id="childDOB" required /></label></div>
        <div><label>Child Age (years &amp; months)<input type="text" name="childAge" id="childAge" readonly /></label>
        </div>
      </div>

      <div class="row">
        <div><label>Location<input type="text" name="location" id="location" placeholder="Area / City"
              required /></label></div>
        <div>
          <label>Mobile
            <input type="tel" name="mobile" id="mobile" inputmode="numeric" pattern="^\d{10}$" maxlength="10"
              placeholder="9812345678" required />
            <span class="small-note">(Will be added to WhatsApp for communication)</span>
          </label>
        </div>
      </div>

<div class="row">
        <div>
          <label>Have you previously attended our beach event?
            <select name="attendedBefore" id="attendedBefore" required>
              <option value="" selected disabled>-- Select an option --</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </label>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Are you a Jungle Cubs Gym Parent?
            <select name="status" id="status" required>
              <option value="" selected disabled>-- Select Status --</option>
              <option value="In-house Parent">In-house Parent (Jungle Cubs Gym Parent)</option>
              <option value="Outsider">Outsider (Not a Jungle Cubs Gym Parent)</option>
            </select>
          </label>
        </div>
        <div id="feesWrap" class="hidden" style="display:none !important;">
          <label>Fees Paid Status
            <select name="feesPaid" id="feesPaid">
              <option value="Not Applicable" selected>Not Applicable</option>
            </select>
          </label>
        </div>
      </div>

      <div class="row">
        <div id="centreWrap" class="hidden">
          <label>Centre
            <select name="centre" id="centre">
              <option value="" selected disabled>-- Select your Centre --</option>
              <option>Hughes Road</option><option>Worli</option><option>Wadala</option><option>Matunga</option>
              <option>Lalbaug</option><option>Chembur</option><option>Ghatkopar</option><option>Powai</option>
              <option>Mulund</option><option>Thane Ram Maruti Road</option><option>Thane Hiranandani Estate</option>
              <option>Bandra</option><option>Malad</option><option>Borivali</option><option>Belapur</option>
            </select>
          </label>
        </div>
        <div>
          <label>Beach Event Date
            <select name="beachEventDate" id="beachEventDate" required>

              <option value="" selected disabled>-- Select Date & Time --</option>

              <option data-event-date="2026-02-28">
                28th February, Saturday ; 5pm to 6pm ; Ages 1.5 - 2.5 Years (Juhu) - Holi Special
              </option>

                <option data-event-date="2026-03-01">
                01st March, Sunday ; 7:30am to 8:30am ; Ages 2.5 - 6 Years (Juhu) - Holi Special
              </option>

              <option data-event-date="Future" data-sold-out="true">
                No other event date
              </option>


            </select>
            <span class="small-note">(Please check Day-Date / Time / Venue &amp; Age Group)</span>
          </label>
        </div>
      </div>

      <input type="hidden" name="paymentNeeded" id="paymentNeeded" value="Pending" />
      <input type="hidden" name="paid" value="No" />
      <input type="hidden" name="transactionRef" id="transactionRefHidden" value="" />

      <div id="summaryWrap" class="summary hidden">
        <strong style="color: var(--jc-green); font-size:1.05rem;">Payment Needed:</strong> <span id="paymentText"
          style="font-weight:bold;">‚Äî</span>
        <div class="muted rich" id="personalMsg"></div>

        <div id="paySection" class="hidden" style="margin-top:12px;">
          <div style="font-size:0.9rem; margin-bottom:12px; color:#555;">
            Please press the <strong>Pay</strong> button or scan the <strong>QR code</strong>.
          </div>

          <div class="pay-wrap">
            <div class="pay-col">
              <a id="gpayButton" class="button-style" href="#"
                style="background:#0F9D58; color:white; margin:0 0 8px 0;" target="_blank">Pay ‚Çπ400 with Google Pay</a>
              <span class="small-note">Pay via <strong>GPay app</strong> with the button above.</span>

              <a id="upiButton" class="button-style secondary" href="#"
                style="margin-top:16px; background:var(--jc-red);" target="_blank">Pay ‚Çπ400 via UPI (any app)</a>
              <span class="small-note">Pay via <strong>other UPI apps</strong> with the button above.</span>
            </div>
            <div class="qr-box">
              <div style="font-weight:700; margin-bottom:8px; color:var(--jc-green);">Jungle Cubs Gym UPI QR</div>
              <img id="qrImg" src="" alt="UPI QR" style="width:200px; height:200px; object-fit:contain;" />
              <div class="hint">Scan to pay ‚Çπ400</div>
            </div>
          </div>
          <div id="paymentConfirmBlock" class="payment-confirm">
            <label class="payment-confirm-label">
              <input type="checkbox" id="paymentConfirmed" name="paymentConfirmed">
              <span>I have made the payment and I will send a screenshot of the payment on WhatsApp.</span>
            </label>
          </div>
        </div>
      </div>

      <button id="registerSendBtn" class="button-style primary" type="button" disabled>
        Register &amp; Send WhatsApp
      </button>
      <p class="subtitle" style="text-align: center; margin-top:8px; font-size:0.85rem; color:#666;">
        WhatsApp will open. Please Send us the pre-filled message.
      </p>
    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      // ----- CONFIG -----
      const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbz0LAoulgRotpvi7RbRPluwZh2L3FoR1ilI3f2f27t-ZRVgz8mN8fYFujlylIIDMgbr/exec";

      // --- FIX: Added '@' symbol to the UPI ID ---
      const BUSINESS_UPI = "junglecubsgym7@oksbi";

      const BUSINESS_NAME = "Jungle Cubs Gym";
      const WHATSAPP_TARGET = "919326068804";

      // ----- ELEMENTS -----
      const form = document.getElementById("beachForm");
      const parentNameEl = document.getElementById("parentName");
      const childNameEl = document.getElementById("childName");
      const dobEl = document.getElementById("childDOB");
      const ageEl = document.getElementById("childAge");
      const mobileEl = document.getElementById("mobile");
      const attendedBeforeEl = document.getElementById("attendedBefore");
      const statusEl = document.getElementById("status");
      const feesWrap = document.getElementById("feesWrap");
      const feesEl = document.getElementById("feesPaid");
      const centreWrap = document.getElementById("centreWrap");
      const centreEl = document.getElementById("centre");
      const beachDateEl = document.getElementById("beachEventDate");
      const paymentNeededHidden = document.getElementById("paymentNeeded");
      const summaryWrap = document.getElementById("summaryWrap");
      const paymentText = document.getElementById("paymentText");
      const personalMsg = document.getElementById("personalMsg");
      const paySection = document.getElementById("paySection");
      const upiButton = document.getElementById("upiButton");
      const gpayButton = document.getElementById("gpayButton");
      const qrImg = document.getElementById("qrImg");
      const txnRefHidden = document.getElementById("transactionRefHidden");
      const registerBtn = document.getElementById("registerSendBtn");
      const paymentConfirmedEl = document.getElementById("paymentConfirmed");
      const paymentConfirmBlock = document.getElementById("paymentConfirmBlock");

      registerBtn.disabled = true;

      if (paymentConfirmedEl) {
        paymentConfirmedEl.addEventListener("change", updateUI);
      }

      // ----- HELPERS -----
      mobileEl.addEventListener('input', () => {
        mobileEl.value = mobileEl.value.replace(/\D/g, '').slice(0, 10);
      });

      dobEl.addEventListener("change", () => {
        if (!dobEl.value) { ageEl.value = ""; return; }
        const dob = new Date(dobEl.value), today = new Date();
        let years = today.getFullYear() - dob.getFullYear();
        let months = today.getMonth() - dob.getMonth();
        if (today.getDate() < dob.getDate()) months -= 1;
        if (months < 0) { years -= 1; months += 12; }
        if (years < 0) { years = 0; months = 0; }
        ageEl.value = `${years} years ${months} months`;
      });

      function computePaymentNeeded(status) {
        if (!status) return 'Pending';
        return 'Yes'; // Payment mandatory for everyone
      }

      function buildUpiLink(amount, parent, child) {
        const tn = `Beach Event fee for ${child || 'child'} - ${parent || 'parent'}`;
        return `upi://pay?pa=${encodeURIComponent(BUSINESS_UPI)}&pn=${encodeURIComponent(BUSINESS_NAME)}&am=${encodeURIComponent(amount)}&cu=INR&tn=${encodeURIComponent(tn)}`;
      }

      function buildQrUrl(upiLink) {
        return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upiLink)}`;
      }

      function splitEventLines(eventStr) {
        const clean = (eventStr || '').trim();
        if (!clean) return { dateLine: '', timeLine: '', ageLine: '' };
        const parts = clean.split(';').map(p => p.trim());
        return {
          dateLine: parts[0] || '',
          timeLine: parts[1] || '',
          ageLine: parts.slice(2).join('; ').trim()
        };
      }

      // WhatsApp text with bold names, nice formatting, footer
      function buildWhatsappText(parent, child, status, need, eventStr, txnRef) {
        const parentClean = (parent || '-').trim();
        const childClean = (child || '-').trim();
        const attendedBefore = attendedBeforeEl ? attendedBeforeEl.value : "";

        const parentB = `*${parentClean}*`;
        const childB = `*${childClean}*`;

        let statusLabel = status || '';
        const st = (status || '').toLowerCase();

        if (st === 'in-house parent') {
          statusLabel = 'In-house Parent';
        } else if (st === 'outsider') {
          statusLabel = 'Outsider (Not Jungle Cubs Gym Parent)';
        }

        const { dateLine, timeLine, ageLine } = splitEventLines(eventStr);

        const lines = [];
        lines.push('üèñÔ∏è *Jungle Cubs Beach Event Registration*');
        lines.push('');
        lines.push(`üë®‚Äçüë©‚Äçüëß Parent: ${parentB}`);
        lines.push(`üßí Child: ${childB}`);

        if (attendedBefore) {
          lines.push(`üë£ Attended Beach Event Before: *${attendedBefore}*`);
        }

        if (st === 'outsider') {
          lines.push(`üå± Status: ${statusLabel}`);
        } else {
          lines.push(`üè´ Status: ${statusLabel}`);
        }
        lines.push('');
        lines.push('üìÖ Event:');
        if (dateLine) lines.push(dateLine);
        if (timeLine) lines.push(timeLine);
        if (ageLine) lines.push(ageLine);

        if (need === 'Yes') {
          lines.push('');
          lines.push('üí∞ Payment Needed: *Yes (‚Çπ400)*');
          lines.push(`üßæ Payment Reference: *${(txnRef || '-').trim()}*`);
          lines.push('');
          lines.push(`‚ú® Thank you for the payment of ‚Çπ400, ${parentB}, ‚Äî enjoy your beach event with ${childB}.`);

          if (st === 'outsider') {
            lines.push('');
            lines.push('We hope to see you soon at Jungle Cubs Gym!');
          }
        }

        lines.push('');
        lines.push('‚Äî‚Äî‚Äî');
        lines.push('Follow us on Instagram:');
        lines.push('https://instagram.com/junglecubsgym');
        lines.push('');
        lines.push('Visit us at:');
        lines.push('https://junglecubsgyms.com');

        return lines.join('\n');
      }

      function updatePersonalLine(need) {
        const parent = parentNameEl.value || "Parent";
        const child = childNameEl.value || "your child";

        if (need === "Yes") {
          personalMsg.innerHTML = `
Hello <strong>${parent}</strong>, kindly pay <strong>‚Çπ400</strong> towards the beach event for <strong>${child}</strong>.`;
        } else {
          personalMsg.innerHTML = `Please complete the required selections.`;
        }
      }

      function updateUI() {
        // NOTE: We do NOT re-enable the button if it has the "submitting" flag
        if (registerBtn.getAttribute("data-submitting") === "true") return;

        registerBtn.style.display = "block";
        registerBtn.disabled = true;

        const statusVal = (statusEl.value || "");
        const inHouse = statusVal === "In-house Parent";

        // Show/hide in-house extras (Only Centre now)
        const showInHouseExtras = inHouse;
        centreWrap.classList.toggle("hidden", !showInHouseExtras);
        centreEl.required = showInHouseExtras;

        // Fees no longer needed, hide it always
        // if (!inHouse) { centreEl.value = ""; } 
        // We leave centreEl value as is if hidden, or you can clear it. Clearing is safer:
        if (!inHouse) { centreEl.value = ""; }

        // Determine need: Yes / No / Pending
        const need = computePaymentNeeded(statusVal);
        paymentNeededHidden.value = need;

        if (!statusVal) {
          summaryWrap.classList.add("hidden");
          paySection.classList.add("hidden");
          paymentConfirmBlock.style.display = "none";
          paymentText.textContent = "‚Äî";
          personalMsg.textContent = "";
          registerBtn.disabled = true;
        } else {
          // ALWAYS show summary once status is selected
          summaryWrap.classList.remove("hidden");
        }

        paymentText.textContent = (need === "Yes") ? "Yes (‚Çπ400)" : (need === "No" ? "No" : "‚Äî");
        updatePersonalLine(need);

        if (need === "Yes" && BUSINESS_UPI && BUSINESS_UPI.includes("@")) {
          paymentConfirmBlock.style.display = "block";
          const upi = buildUpiLink(400, parentNameEl.value, childNameEl.value);

          // Store UPI for handlers
          upiButton.href = upi;
          upiButton.dataset.upi = upi;
          if (gpayButton) gpayButton.dataset.upi = upi;

          qrImg.src = buildQrUrl(upi);
          qrImg.alt = "UPI QR for ‚Çπ400";
          paySection.classList.remove("hidden");
        } else {
          paymentConfirmBlock.style.display = "none";
          if (paymentConfirmedEl) paymentConfirmedEl.checked = false;
          paySection.classList.add("hidden");

          upiButton.removeAttribute("data-upi");
          upiButton.href = "#";
          if (gpayButton) gpayButton.removeAttribute("data-upi");
        }

        // Sync hidden transaction ref with payment confirmation checkbox
        if (paymentConfirmedEl && txnRefHidden) {
          if (paymentConfirmedEl.checked) {
            txnRefHidden.value = "Payment screenshot will be shared on WhatsApp";
          } else {
            txnRefHidden.value = "";
          }
        }

        const formValid = form.checkValidity();
        const paymentOk = (need === "Yes") ? paymentConfirmedEl.checked : true;
        registerBtn.disabled = !(formValid && paymentOk);
      }

      // Re-evaluate on all inputs/selects
      ['change', 'input', 'blur'].forEach(evt => {
        document.querySelectorAll('input, select').forEach(el => el.addEventListener(evt, updateUI));
      });

      // Generic UPI button: use intent on Android, direct UPI on others
      if (upiButton) {
        upiButton.addEventListener("click", function (e) {
          const upi = this.dataset.upi;
          if (!upi) return;

          e.preventDefault();

          const ua = navigator.userAgent || "";
          const isAndroid = /Android/i.test(ua);

          if (isAndroid) {
            const withoutScheme = upi.replace(/^upi:\/\//, "");
            const intentUrl = "intent://" + withoutScheme + "#Intent;scheme=upi;end";
            const win = window.open(intentUrl, "_blank");
            if (!win) window.location.href = intentUrl;
          } else {
            const win = window.open(upi, "_blank");
            if (!win) window.location.href = upi;
          }
        });
      }

      // Google Pay‚Äìspecific button (proper params so GPay shows 400 & Jungle Cubs)
      if (gpayButton) {
        gpayButton.addEventListener("click", function (e) {
          e.preventDefault();

          const parent = parentNameEl.value || "parent";
          const child = childNameEl.value || "child";

          const upiParams =
            "pa=" + encodeURIComponent(BUSINESS_UPI) +
            "&pn=" + encodeURIComponent(BUSINESS_NAME) +
            "&am=400&cu=INR" +
            "&tn=" + encodeURIComponent("Beach Event fee for " + child);

          const ua = navigator.userAgent || "";
          const isAndroid = /Android/i.test(ua);
          const isIOS = /iPhone|iPad|iPod/i.test(ua);

          if (isAndroid) {
            const intentUrl =
              "intent://pay?" + upiParams +
              "#Intent;scheme=upi;package=com.google.android.apps.nbu.paisa.user;end";
            const w = window.open(intentUrl, "_blank");
            if (!w) window.location.href = intentUrl;
          } else if (isIOS) {
            const iosUrl = "gpay://upi/pay?" + upiParams;
            const w = window.open(iosUrl, "_blank");
            if (!w) window.location.href = iosUrl;
          } else {
            const upi = "upi://pay?" + upiParams;
            const w = window.open(upi, "_blank");
            if (!w) window.location.href = upi;
          }
        });
      }

      // --- MAIN UPDATE: BUTTON CLICK HANDLER ---
      registerBtn.addEventListener('click', () => {
        // 1. Validation Checks
        const need = paymentNeededHidden.value;
        if (!form.checkValidity()) { form.reportValidity(); return; }
        if (need === 'Yes' && !paymentConfirmedEl.checked) {
          alert("Please confirm that you have completed the payment.");
          return;
        }

        // 2. Prevent Double Submits immediately
        if (registerBtn.getAttribute("data-submitting") === "true") return;
        registerBtn.setAttribute("data-submitting", "true");
        registerBtn.disabled = true;
        registerBtn.innerHTML = "‚è≥ Processing... Opening WhatsApp";

        // 3. Prepare WhatsApp Logic
        const waText = buildWhatsappText(
          parentNameEl.value, childNameEl.value,
          statusEl.value, need, beachDateEl.value,
          txnRefHidden.value.trim()
        );
        const waUrl = `https://wa.me/${WHATSAPP_TARGET}?text=${encodeURIComponent(waText)}`;

        // 4. Open WhatsApp
        window.open(waUrl, '_blank', 'noopener');

        // 5. Submit Form (with small delay to allow UI update)
        setTimeout(() => {
          form.action = ENDPOINT_URL;
          form.submit();
        }, 500);
      });

      // Disable past beach event dates (RESTORED)
      (function disablePastAndSoldOutDates() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const options = beachDateEl.querySelectorAll('option[data-event-date]');

        options.forEach(opt => {
          const eventDateStr = opt.getAttribute('data-event-date');
          const isSoldOut = opt.getAttribute('data-sold-out') === 'true';
          if (!eventDateStr) return;

          const eventDate = new Date(eventDateStr);

          // Disable past dates
          if (eventDate < today) {
            opt.disabled = true;
            opt.style.color = '#999';
          }

          // Disable sold-out dates
          if (isSoldOut) {
            opt.disabled = true;
            opt.style.color = '#c72e31';   // Jungle Red
            opt.style.fontWeight = '600';
          }
        });
      })();

      // Run once on page load to set correct initial UI state
      updateUI();

    });
  </script>
</body>

</html>